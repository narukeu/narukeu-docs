# 微服务项目中鉴权逻辑和分工

在企业级微服务架构中，遵循“职责分离”原则，安全逻辑被清晰地划分到不同层次的服务中。

## 一、API 网关

### 定位

统一流量入口，边界“安检员”。

### 核心职责

#### 路由与横切

负责路由转发、负载均衡、全局跨域、限流熔断。

#### 粗粒度认证

- **做什么**：校验请求是否携带 Token，并对 Token 进行基础有效性验证（如格式、签名、有效期）。它是第一道防线，快速过滤掉大量非法请求。
- **不做什么**：不处理登录逻辑，不颁发 Token，不关心用户具体拥有哪些业务权限。

#### 白名单管理

放行登录、注册、文档等无需鉴权的公共 API。

#### 上下文透传

解析 Token 后，可将用户 ID 等基础信息放入请求头，传递给下游服务。

## 二、认证中心

### 定位

身份的集中“签发与管理机构”。

### 核心职责

#### 身份认证

处理用户的登录、注册、登出请求。

#### 凭证管理

**颁发、刷新、吊销**访问凭证（如 JWT）。是 Token 生命周期的唯一管理者。

#### 会话管理

管理用户登录状态，例如通过 Redis 记录在线会话，以支持单点登录或强制下线等高级功能。

#### 配套功能

提供验证码、密码策略、登录审计等与身份认证相关的功能。

## 三、业务微服务

### 定位

业务权限的“最终决策者”。

### 核心职责

#### 细粒度授权

- **必须**对接收到的请求再次校验 Token 的合法性，**绝不**盲目信任网关透传的任何用户信息。
- 基于自身业务逻辑，结合 RBAC（角色-权限）模型，判断当前用户是否有权执行特定操作或访问特定资源。
- 实现数据权限等更复杂的安全控制。

## 协作流程示意

1.  **登录**：`用户` -> `网关 (白名单放行)` -> `认证中心 (校验凭证, 颁发 Token)` -> `用户`。
2.  **访问受保护资源**：`用户 (携带 Token)` -> `网关 (粗略校验 Token)` -> `业务微服务 (再次校验 Token 并进行权限判定)` -> `返回结果`。
